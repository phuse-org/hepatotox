 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Figure 01: Plot of Maximum Total Bilirubin Versus Maximum ALT or AST or ALP</title>

  <!-- ✅ Quarto/Bootstrap assets (match index.html) -->
  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <style>
    :root{font-family:Segoe UI, Roboto, system-ui, -apple-system, sans-serif;color:#222;}
    body{margin:0;padding:0;background:#f7f7fb;}
    .container{max-width:1100px;margin:100px auto 40px;background:#fff;border-radius:10px;padding:20px;box-shadow:0 6px 18px rgba(20,20,40,0.06);}
    h1{margin:0 0 6px;text-align:center;font-size:20px;}
    .subtitle{text-align:center;color:#444;margin-bottom:18px;font-size:14px;}

    /* code wrapper */
    .code-wrapper{position:relative;border:1px solid #e6e6e6;border-radius:8px;background:#f2f2f2;overflow:hidden;}
    .code-viewport{max-height:55vh;overflow:auto;padding:12px;font-family:"Fira Code", Consolas, monospace;font-size:13px;line-height:1.4;background:transparent;}
    .lines{min-width:min-content;}
    .line{display:flex;align-items:flex-start;gap:12px;white-space:pre;}
    .ln{width:60px;text-align:right;color:#666;user-select:none;flex:0 0 60px;padding-right:6px;}
    .content{flex:1 1 auto;white-space:pre;overflow:visible;color:#111;}

    /* Copy button */
    .copy-btn{position:absolute;top:8px;right:8px;z-index:3;padding:6px 10px;border-radius:6px;border:0;background:#2563eb;color:#fff;cursor:pointer;font-weight:600;}
    .copy-btn:active{transform:translateY(1px);}

    /* image and buttons */
    .image-container{text-align:center;margin-top:16px;}
    .image-container img{max-width:100%;height:auto;border-radius:6px;border:1px solid #ddd;display:inline-block;}

    .buttons{text-align:center;margin-top:14px;}
    .buttons a.btn{display:inline-block;margin:6px;padding:10px 18px;border-radius:8px;background:#2563eb;color:#fff;text-decoration:none;font-weight:600;}
    .buttons a.btn:hover{background:#1e4db7;}

    footer{text-align:center;font-size:13px;color:#666;margin-top:18px;}

    @media(max-width:700px){
      .ln{width:48px;flex:0 0 48px;text-align:right;}
      .copy-btn{top:6px;right:6px;}
    }
  </style>

  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    .navbar-custom {
      background-color: #003366; /* deep navy */
    }
    .navbar-custom .nav-link {
      font-size: 1.1rem;
      font-weight: 500;
      color: #ffffff;
    }
    .navbar-custom .nav-link:hover {
      color: #ffcc00;
    }
    .navbar-custom .dropdown-menu {
      background-color: #003366;
    }
    .navbar-custom .dropdown-item {
      color: #ffffff;
    }
    .navbar-custom .dropdown-item:hover {
      background-color: #002244;
      color: #ffcc00;
    }
  </style>

</head>
<body class="nav-fixed fullcontent">

<!-- ✅ Full navbar copied from index.html -->
  
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
  <div class="container-fluid">
    <a class="navbar-brand" href="./index.html">
      <img src="hepatotox-hex.png" alt="Hepatotox Logo" width="40" height="40" class="d-inline-block align-text-top">
      Hepatotox Catalog
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="./index.html">Home</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="articlesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Articles</a>
          <ul class="dropdown-menu" aria-labelledby="articlesDropdown">
            <li><a class="dropdown-item" href="./introduction.html">Introduction to Hepatotox</a></li>
            <li><a class="dropdown-item" href="./liver-enzyme.html">Liver Enzymes Overview</a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="tablesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Tables</a>
          <ul class="dropdown-menu" aria-labelledby="tablesDropdown">
            <li><a class="dropdown-item" href="./table01.html">Table 01</a></li>
            <li><a class="dropdown-item" href="./table02.html">Table 02</a></li>
            <li><a class="dropdown-item" href="./table03.html">Table 03</a></li>
            <li><a class="dropdown-item" href="./table04.html">Table 04</a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="figuresDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Figures</a>
          <ul class="dropdown-menu" aria-labelledby="figuresDropdown">
            <li><a class="dropdown-item" href="./figure01.html">Figure 01</a></li>
            <li><a class="dropdown-item" href="./figure02.html">Figure 02</a></li>
            <li><a class="dropdown-item" href="./figure03.html">Figure 03</a></li>
            <li><a class="dropdown-item" href="./figure04.html">Figure 04</a></li>
            <li><a class="dropdown-item" href="./figure05.html">Figure 05</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="./resources.html">Resources</a></li>
      </ul>
    </div>
  </div>
</nav>


  <!-- ✅ Page content -->
  <div class="container">
    <h1>Figure 01: Plot of Maximum Total Bilirubin Versus Maximum ALT or AST or ALP</h1>
    <div class="subtitle">
      The datasets used for the program are modified versions of the <strong>ADLB.Rda & ADSL.Rda</strong> 
      from the <strong>random.cdisc.data</strong> library. Copy the code below to create an interactive plot
of maximum total bilirubin versus maximum ALT or AST or ALP.
    </div>

    <div class="code-wrapper" id="codeWrapper" aria-label="R program code area">
      <button class="copy-btn" id="copyBtn">Copy Code</button>
      <div class="code-viewport" id="codeViewport" tabindex="0" aria-label="R program scrollable code">
        <div class="lines" id="lines"></div>
      </div>
    </div>

    <p style="margin-top:20px;font-weight:600;">The generated output is below:</p>
    <div class="image-container">

    <iframe src="https://rxu6nu-dimple-patel.shinyapps.io/fig1_app/" 
            style="width:100%; height:600px; border:1px solid #ddd; border-radius:6px;">
    </iframe>

      
    </div>

    
  </div>

  <!-- ✅ R code preserved -->
  <script id="rawCode" type="text/plain">
#Load appropriate libraries.
library(dplyr)
library(tern)
library(random.cdisc.data)
library(tidyverse)
library(magrittr)
library(r2rtf)
library(formatters)
library(grid)
library(shiny)
library(plotly)

#Load ADLB dataset.
load(url("https://raw.githubusercontent.com/phuse-org/hepatotox/main/docs/data/adlbf1.Rda"))

#Load ADSL dataset.
load(url("https://raw.githubusercontent.com/phuse-org/hepatotox/main/docs/data/adslf1.Rda"))

#NAs are explicit missing levels.
adlb2aa <- df_explicit_na(adlbf1)

#Rename the treatment arms & parameter codes.
levels(adlb2aa$ACTARMCD) <- c("T1", "PL", "T2")
levels(adslf1$ACTARMCD) <- c("T1", "PL", "T2")
levels(adlb2aa$ARM) <- c("Treatment 1", "Placebo", "Treatment 2")
levels(adlb2aa$PARAMCD) <- c("ALP", "ALT", "AST", "TBILI")
adlb2aa$PARAMCD <- factor(adlb2aa$PARAMCD, levels = c("ALT", "AST", "TBILI", "ALP"))
adlb2aa$PARAM <- factor(adlb2aa$PARAM, levels = c("Alanine Aminotransferase Measurement", "Aspartate Aminotransferase Measurement", "Total Bilirubin Measurement", "Alkaline Phosphatase Measurement"))
adlb2aa$ACTARMCD <- factor(adlb2aa$ACTARMCD, levels = c("PL", "T1", "T2")) 
adslf1$ACTARMCD <- factor(adslf1$ACTARMCD, levels = c("PL", "T1", "T2")) 
levels(adslf1$ARM) <- c("Treatment 1", "Placebo", "Treatment 2")

adlb2a <- adlb2aa %>% add_column(RUNNUM=runif(nrow(.)))

#Flag the maximum post-baseline result.
adlb2b <- adlb2a %>% filter(SAFFL == "Y" & AVISITN %in% c(1, 2)) %>%
  group_by(USUBJID, PARAMCD) %>% slice_max(AVAL) %>% mutate(MPBR = "Y")

#Calculate AVAL in terms of ULN for PARAMCD == (TBILI, ALT,AST, ALP).
adlb2c <- adlb2b %>% filter(PARAMCD %in% c("ALT", "AST", "TBILI", "ALP") & MPBR == "Y") %>%
  mutate(MAXU = case_when(PARAMCD == "ALT" ~ AVAL/55, PARAMCD == "AST" ~ AVAL/33, PARAMCD == "ALP" ~ AVAL/147), MAXUB = case_when(PARAMCD == "TBILI" ~ AVAL/1.2))

adlb2all1 <- pivot_wider(adlb2c, id_cols = SUBJID, names_from = PARAMCD, values_from = c(MAXU, MAXUB, AVISIT))

adlb2all2 <- merge(x = adlb2all1, y = adslf1[ , c("SUBJID", "ACTARMCD", "ARM")], by = "SUBJID", all.x = TRUE) %>% mutate(ALTr = round(MAXU_ALT, 3), ASTr = round(MAXU_AST, 3), ALPr = round(MAXU_ALP, 3), TBILIr = round(MAXUB_TBILI, 3)) %>%
  subset(select = c(SUBJID, ACTARMCD, ARM,  ALTr, ASTr, ALPr, TBILIr, AVISIT_ALT, AVISIT_AST)) 

#Create RShiny app's UI and Server Components.
ui = navbarPage("Figure 1",
                  uiOutput("all"),
                  tabPanel("Plot",
                           icon = icon("chart-area"),
                           sidebarLayout(sidebarPanel(
                             selectInput("Plot", "Please select a Liver Biochemical Test to view:",
                                         choices = c("ALT", 
                                                     "AST", 
                                                     "ALP")),
                             actionButton("submit", "Submit")),
                             mainPanel(
                            titlePanel("Figure 1"), 
                            plotlyOutput(outputId = "Plots")
                           ))))

server = function(input, output, session) {

  observeEvent(input$submit,{

plotalt <- plot_ly(adlb2all2 %>% filter(ACTARMCD == "PL"), 
            x = ~ALTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            name = "Placebo",
            marker = list(color = "aquamarine"),
            hoverinfo = "text",
            hovertext = ~paste("Subject: ", SUBJID, '<br>Arm:', ARM, '<br>Visit:', AVISIT_ALT,
                               '<br> x-axis:', ALTr, '<br> y-axis:', TBILIr)) %>%
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T1"),
            x = ~ALTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "lightslategray"),
            name = "Treatment 1") %>% 
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T2"),
            x = ~ALTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "hotpink"),
            name = "Treatment 2") %>%
    layout(title = "Plot of Maximum Total Bilirubin Versus Maximum ALT or AST or ALP\n<Analysis Set>",
           xaxis = list(title = "Alanine Aminotransferase/ULN", showgrid = FALSE),
           yaxis = list(title = 'Bilirubin/ULN', showgrid = FALSE),
           plot_bgcolor = "white",
           paper_bgcolor = "white",
           shapes = list(
      list(
        type = "line",
        x0 = 0,
        x1 = 20,
        y0 = 2,
        y1 = 2,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      ),
      list(
        type = "line",
        x0 = 3,
        x1 = 3,
        y0 = 0,
        y1 = 12,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      )
    ))
  
plotast <- plot_ly(adlb2all2 %>% filter(ACTARMCD == "PL"), 
            x = ~ASTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            name = "Placebo",
            marker = list(color = "aquamarine"),
            hoverinfo = "text",
            hovertext = ~paste("Subject: ", SUBJID, '<br>Arm:', ARM, '<br>Visit:', AVISIT_AST,
                               '<br> x-axis:', ASTr, '<br> y-axis:', TBILIr)) %>%
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T1"),
            x = ~ASTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "lightslategray"),
            name = "Treatment 1") %>% 
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T2"),
            x = ~ASTr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "hotpink"),
            name = "Treatment 2") %>%
    layout(title = "Plot of Maximum Total Bilirubin Versus Maximum ALT or AST or ALP\n<Analysis Set>",
            xaxis = list(title = "Aspartate Aminotransferase/ULN", showgrid = FALSE),
            yaxis = list(title = 'Bilirubin/ULN', showgrid = FALSE),
            plot_bgcolor = "white",
            paper_bgcolor = "white",
           shapes = list(
      list(
        type = "line",
        x0 = 0,
        x1 = 20,
        y0 = 2,
        y1 = 2,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      ),
      list(
        type = "line",
        x0 = 3,
        x1 = 3,
        y0 = 0,
        y1 = 12,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      )
      ))

plotalp <- plot_ly(adlb2all2 %>% filter(ACTARMCD == "PL"), 
            x = ~ALPr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            name = "Placebo",
            marker = list(color = "aquamarine"),
            hoverinfo = "text",
            hovertext = ~paste("Subject: ", SUBJID, '<br>Arm:', ARM, '<br>Visit:', AVISIT_AST,
                               '<br> x-axis:', ASTr, '<br> y-axis:', TBILIr)) %>%
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T1"),
            x = ~ALPr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "lightslategray"),
            name = "Treatment 1") %>% 
    add_trace(data = adlb2all2 %>% filter(ACTARMCD == "T2"),
            x = ~ALPr,
            y = ~TBILIr,
            type = 'scatter', 
            color = ~ACTARMCD,
            mode = 'markers',
            marker = list(color = "hotpink"),
            name = "Treatment 2") %>%
    layout(title = "Plot of Maximum Total Bilirubin Versus Maximum ALT or AST or ALP\n<Analysis Set>",
            xaxis = list(title = "Alkaline Phosphatase/ULN", showgrid = FALSE),
            yaxis = list(title = 'Bilirubin/ULN', showgrid = FALSE),
            plot_bgcolor = "white",
            paper_bgcolor = "white",
           shapes = list(
      list(
        type = "line",
        x0 = 0,
        x1 = 5,
        y0 = 2,
        y1 = 2,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      ),
      list(
        type = "line",
        x0 = 2,
        x1 = 2,
        y0 = 0,
        y1 = 12,
        line = list(color = "darkgray", width = 1.6, dash = "dash")
      )
      ))

    output$Plots = renderPlotly({
    switch(isolate(input$Plot),
           "ALT" = plotalt,
           "AST" = plotast,
           "ALP" = plotalp
       )
})

  })}

shinyApp(ui, server)
  </script>

  <script>
    (function(){
      let raw = document.getElementById('rawCode').textContent.replace(/\r/g, '').replace(/^\n+/, '').replace(/\n+$/, '');
      const linesArray = raw.split('\n');
      const linesContainer = document.getElementById('lines');
      const frag = document.createDocumentFragment();
      linesArray.forEach((text, idx) => {
        const row = document.createElement('div'); row.className='line';
        const ln = document.createElement('div'); ln.className='ln'; ln.textContent = idx+1;
        const content = document.createElement('div'); content.className='content'; content.textContent=text;
        row.appendChild(ln); row.appendChild(content); frag.appendChild(row);
      });
      linesContainer.appendChild(frag);

      document.getElementById('copyBtn').addEventListener('click', async ()=>{
        try {
          await navigator.clipboard.writeText(raw);
          let b=document.getElementById('copyBtn');
          b.textContent='Copied!';
          setTimeout(()=>b.textContent='Copy Code',1200);
        } catch(e) {
          alert('Copy failed');
        }
      });
    })();
  </script>
</body>
</html>
